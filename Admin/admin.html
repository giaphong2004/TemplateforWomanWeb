<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Quản Trị - LadyHeath</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="admin-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="#" class="logo">LadyHeath</a>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li class="nav-item active">
                        <a href="index.html"><i class="fas fa-tachometer-alt"></i> Tổng quan</a>
                    </li>
                    <li class="nav-item">
                        <a href="users.html"><i class="fas fa-users"></i> Người dùng</a>
                    </li>
                    <li class="nav-item has-submenu">
                        <a href="#"><i class="fas fa-file-alt"></i> Nội dung</a>
                        <ul class="submenu">
                            <li><a href="posts.html">Sức khỏe A-Z</a></li>
                            <li><a href="experts.html">Chuyên gia</a></li>
                            <li><a href="#">Công cụ</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="tools.html"><i class="fa-solid fa-wrench"></i>Công cụ</a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="#"><i class="fas fa-sign-out-alt"></i> Đăng xuất</a>
            </div>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <div class="header-welcome">
                    <span>Chào mừng, <strong>Admin</strong></span>
                </div>
                <div class="header-user">
                    <i class="fas fa-user-circle user-avatar"></i>
                </div>
            </header>

            <div class="page-content" id="page-content">
            </div>
        </main>
    </div>



    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const links = document.querySelectorAll('.sidebar-nav a');
            const pageContent = document.getElementById('page-content');

            /**
             * HÀM TÁI SỬ DỤNG ĐỂ THIẾT LẬP SỰ KIỆN CHO MODAL
             */
            const setupModalEvents = (triggerSelector, modalSelector) => {
                const triggerButton = pageContent.querySelector(triggerSelector);
                const modal = pageContent.querySelector(modalSelector);
                if (!triggerButton || !modal) return;

                const closeModalBtn = modal.querySelector('.close-btn');
                const cancelBtn = modal.querySelector('.cancel-btn');

                const openModal = (e) => {
                    e.preventDefault();
                    modal.classList.add('active');
                }
                const closeModal = () => modal.classList.remove('active');

                triggerButton.addEventListener('click', openModal);
                if (closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
                if (cancelBtn) cancelBtn.addEventListener('click', closeModal);
                modal.addEventListener('click', (event) => {
                    if (event.target === modal) closeModal();
                });
            };

            /**
             * HÀM THIẾT LẬP SỰ KIỆN CHO TRANG BÀI VIẾT (POSTS)
             */
            const setupPostPageEvents = () => {
                const postListView = pageContent.querySelector('#post-list-view');
                const postEditView = pageContent.querySelector('#post-edit-view');
                const addPostBtn = pageContent.querySelector('#add-post-btn');
                const backToListBtn = pageContent.querySelector('#back-to-list-btn');
                const editPostBtns = pageContent.querySelectorAll('.edit-post-btn');

                if (!postListView || !postEditView) return;

                const showEditView = (e) => {
                    e.preventDefault();
                    postListView.classList.add('hidden');
                    postEditView.classList.remove('hidden');
                };

                const showListView = (e) => {
                    e.preventDefault();
                    postEditView.classList.add('hidden');
                    postListView.classList.remove('hidden');
                };

                if (addPostBtn) addPostBtn.addEventListener('click', showEditView);
                if (backToListBtn) backToListBtn.addEventListener('click', showListView);
                editPostBtns.forEach(btn => btn.addEventListener('click', showEditView));
            };

            const initDashboardChart = () => { /* ... code vẽ biểu đồ của bạn ... */ };

            /**
             * HÀM CHÍNH ĐỂ TẢI NỘI DUNG
             */
            const loadContent = (url) => {
                fetch(url)
                    .then(response => response.text())
                    .then(html => {
                        pageContent.innerHTML = html;

                        // KIỂM TRA VÀ CHẠY LOGIC TƯƠNG ỨNG CHO TỪNG TRANG
                        if (url.includes('index.html')) {
                            initDashboardChart();
                        } else if (url.includes('experts.html')) {
                            setupModalEvents('#add-expert-btn', '#add-expert-modal');
                        } else if (url.includes('users.html')) {
                            setupModalEvents('#add-user-btn', '#add-user-modal');
                        } else if (url.includes('posts.html')) {
                            setupPostPageEvents();
                        }
                    })
                    .catch(err => console.error('Failed to load page: ', err));
            };

            // Gán sự kiện click cho các link trong sidebar
            links.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const parentLi = link.parentElement;

                    if (parentLi.classList.contains('has-submenu')) {
                        parentLi.classList.toggle('open');
                    } else {
                        const url = link.getAttribute('href');
                        if (url && url !== '#') {
                            loadContent(url);
                            links.forEach(l => l.parentElement.classList.remove('active'));
                            parentLi.classList.add('active');
                        }
                    }
                });
            });

            // Tải trang mặc định khi vào
            loadContent('index.html');
        });
    </script>
</body>

</html>